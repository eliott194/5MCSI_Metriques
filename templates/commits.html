<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Commits Metrics</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        fetch('/commits/')
          .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            var dataTable = new google.visualization.DataTable();
            dataTable.addColumn('datetime', 'Time');
            // Ajouter dynamiquement une colonne pour chaque auteur
            var authorsSet = new Set(data.results.map(item => item.author));
            var authors = Array.from(authorsSet);
            var colors = ['#e2431e', '#6f9654', '#1c91c0', '#f1ca3a', '#4374e0']; // Palette de couleurs pour les auteurs
            
            authors.forEach(author => {
              dataTable.addColumn('number', author);
            });

            // Préparer les données pour Google Charts
            var formattedData = []; // Cette partie doit être ajustée selon le format de vos données

            // Supposons que vous avez filtré les données par date/heure côté serveur
            // Ici, vous devez organiser ces données dans le format attendu par Google Charts
            data.results.forEach(commit => {
              let commitTime = new Date(commit.date); // Assurez-vous que la date est correctement formatée
              // Ici, vous devez insérer les données dans formattedData
              // Note : cet exemple ne montre pas le comptage précis des commits par minute et par auteur
            });

            // Exemple de données ajoutées à dataTable
            authors.forEach((author, index) => {
              // Ajouter des données exemple pour chaque auteur
              // Vous devez remplacer ceci par votre logique pour compter et organiser les commits
              dataTable.addRow([new Date(), ...Array(authors.length).fill().map((_, i) => i === index ? 1 : null)]);
            });

            var options = {
              title: 'Commits par Minute par Auteur',
              curveType: 'function',
              legend: { position: 'bottom' },
              colors: colors.slice(0, authors.length),
              hAxis: {
                title: 'Temps',
                format: 'HH:mm',
                viewWindow: {
                  min: new Date(2024, 1, 12, 14, 0, 0),
                  max: new Date(2024, 1, 12, 18, 0, 0)
                }
              },
              vAxis: {
                title: 'Nombre de Commits',
              },
            };

            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
          })
          .catch(error => {
            console.error('Fetch error:', error);
          });
      }
    </script>
</head>
<body>
    <div id="chart_div" style="width: 100%; height: 500px;"></div>
</body>
</html>
